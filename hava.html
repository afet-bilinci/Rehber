<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ACE COMBAT â€” TÃœRK HAVA KUVVETLERÄ°</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:#000;overflow:hidden;touch-action:none}
body{display:flex;align-items:center;justify-content:center;font-family:'Share Tech Mono',monospace}
#wrap{
  position:relative;width:100%;max-width:480px;height:100%;max-height:680px;
  aspect-ratio:480/680;flex-shrink:0;
}
canvas{position:absolute;top:0;left:0;width:100%;height:100%;image-rendering:pixelated;pointer-events:none}
#mainCanvas{pointer-events:auto;z-index:10}
#uiCanvas{pointer-events:none;z-index:20}
#fxCanvas{pointer-events:none;z-index:15;mix-blend-mode:screen}
#bgCanvas{z-index:1}

/* ANA MENÃœ */
#overlay{
  position:absolute;inset:0;z-index:50;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  background:radial-gradient(ellipse at 50% 40%, rgba(0,20,60,0.97) 0%, rgba(0,0,0,0.99) 100%);
  overflow-y:auto;padding:20px;
}
#overlay::before{
  content:'';position:absolute;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,255,200,0.015) 2px,rgba(0,255,200,0.015) 4px);
  pointer-events:none;
}
.title-wrap{position:relative;text-align:center;margin-bottom:8px}
.title-bg-glow{
  position:absolute;inset:-30px;
  background:radial-gradient(ellipse,rgba(0,180,255,0.12) 0%,transparent 70%);
  pointer-events:none;
}
.title-sub{
  font-family:'Share Tech Mono',monospace;
  font-size:10px;letter-spacing:6px;color:rgba(0,255,200,0.5);
  margin-bottom:12px;text-transform:uppercase;
}
h1{
  font-family:'Orbitron',sans-serif;font-weight:900;
  font-size:58px;line-height:.95;
  color:transparent;
  background:linear-gradient(180deg,#FFFFFF 0%,#00CCFF 40%,#0066FF 100%);
  -webkit-background-clip:text;background-clip:text;
  filter:drop-shadow(0 0 30px rgba(0,150,255,0.8)) drop-shadow(0 0 60px rgba(0,100,255,0.4));
  letter-spacing:2px;
}
h1 .red{
  background:linear-gradient(180deg,#FF8800 0%,#FF2200 100%);
  -webkit-background-clip:text;background-clip:text;
  filter:drop-shadow(0 0 20px rgba(255,80,0,0.8));
}
.divider{
  width:200px;height:1px;margin:18px auto;
  background:linear-gradient(90deg,transparent,rgba(0,200,255,0.6),transparent);
}

/* BÃ–LÃœM SEÃ‡Ä°M EKRANI */
#chapterSelect{
  display:flex;flex-direction:column;align-items:center;width:100%;
  margin:20px 0;max-height:300px;overflow-y:auto;
}
.chapter-title{
  font-family:'Orbitron',sans-serif;font-size:14px;
  color:#00FFCC;margin:10px 0 5px;letter-spacing:2px;
}
.chapter-grid{
  display:grid;grid-template-columns:repeat(3,1fr);gap:8px;
  width:100%;margin-bottom:15px;
}
.mission-btn{
  background:rgba(0,30,60,0.8);border:1px solid #00CCFF;
  color:#00FFCC;padding:12px 5px;border-radius:4px;
  font-family:'Orbitron',sans-serif;font-size:12px;
  text-align:center;cursor:pointer;transition:all 0.2s;
  box-shadow:0 0 10px rgba(0,200,255,0.2);
}
.mission-btn.completed{
  border-color:#FFCC00;color:#FFCC00;
  box-shadow:0 0 15px rgba(255,200,0,0.3);
}
.mission-btn.locked{
  border-color:#444;color:#666;background:rgba(20,20,20,0.8);
  pointer-events:none;filter:grayscale(0.8);
}
.mission-btn:active{
  background:#00CCFF;color:#000;transform:scale(0.95);
}
.mission-desc{
  font-size:8px;color:rgba(0,200,255,0.5);margin-top:2px;
}

.stat-row{
  display:flex;gap:32px;margin-bottom:24px;
}
.stat-box{text-align:center}
.stat-label{font-size:9px;color:rgba(0,255,200,0.4);letter-spacing:2px}
.stat-val{font-family:'Orbitron',sans-serif;font-size:18px;color:#00FFCC;letter-spacing:1px}
#startBtn{
  font-family:'Orbitron',sans-serif;font-weight:700;
  font-size:18px;letter-spacing:6px;
  color:#000;background:linear-gradient(135deg,#00CCFF,#0066FF);
  border:none;border-radius:2px;
  padding:16px 56px;cursor:pointer;
  position:relative;overflow:hidden;
  box-shadow:0 0 40px rgba(0,150,255,0.5),0 0 80px rgba(0,100,255,0.2);
  transition:all .2s;clip-path:polygon(8px 0,100% 0,calc(100% - 8px) 100%,0 100%);
  margin-top:10px;
}
#startBtn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,255,255,0.3),transparent);
  transform:translateX(-100%);transition:.3s;
}
#startBtn:hover::before{transform:translateX(0)}
#startBtn:active{box-shadow:0 0 60px rgba(0,200,255,0.7);transform:scale(1.04)}
.controls-grid{
  display:grid;grid-template-columns:1fr 1fr;
  gap:8px 28px;margin-top:22px;
}
.ctrl{display:flex;align-items:center;gap:8px;color:rgba(255,255,255,.35);font-size:10px}
.key{
  background:rgba(0,200,255,.08);border:1px solid rgba(0,200,255,.25);
  border-radius:2px;padding:3px 8px;
  font-family:'Orbitron',sans-serif;font-size:9px;color:rgba(0,200,255,.6);
  white-space:nowrap;
}
#finalBlock{display:none;margin-bottom:20px;text-align:center}
.final-score-label{font-size:10px;color:rgba(0,255,200,.4);letter-spacing:3px;margin-bottom:4px}
.final-score-val{font-family:'Orbitron',sans-serif;font-size:48px;color:#00FFCC;
  filter:drop-shadow(0 0 20px rgba(0,255,200,0.6));letter-spacing:2px}
#pauseMenu{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  background:rgba(0,10,30,0.95);border:2px solid #00CCFF;padding:30px 60px;
  border-radius:4px;display:none;flex-direction:column;gap:20px;z-index:100;
  box-shadow:0 0 50px rgba(0,200,255,0.3);text-align:center;
}
#pauseMenu h2{color:#00FFCC;font-family:'Orbitron',sans-serif;margin-bottom:10px}
#pauseMenu button{
  background:transparent;border:2px solid #00CCFF;color:#00FFCC;
  padding:10px 30px;font-family:'Orbitron',sans-serif;cursor:pointer;
  transition:all 0.3s;font-size:16px;
}
#pauseMenu button:active{background:#00CCFF;color:#000;box-shadow:0 0 20px #00CCFF}
#bombBtn{
  position:absolute;bottom:20px;right:20px;width:80px;height:80px;
  border-radius:50%;background:rgba(255,80,0,0.3);
  border:3px solid #FF6600;z-index:30;
  display:flex;align-items:center;justify-content:center;
  font-family:'Orbitron',sans-serif;font-weight:bold;
  color:#FF6600;text-shadow:0 0 10px #FF6600;
  backdrop-filter:blur(5px);pointer-events:auto;
  box-shadow:0 0 30px rgba(255,100,0,0.5);
}
#bombBtn:active{transform:scale(0.9);background:rgba(255,100,0,0.6);}
</style>
</head>
<body>
<div id="wrap">
  <canvas id="bgCanvas"></canvas>
  <canvas id="mainCanvas"></canvas>
  <canvas id="fxCanvas"></canvas>
  <canvas id="uiCanvas"></canvas>

  <!-- BOMBA BUTONU (MOBÄ°L) -->
  <div id="bombBtn" style="display:none">ğŸ’£</div>

  <!-- ANA MENÃœ -->
  <div id="overlay">
    <div class="title-wrap">
      <div class="title-bg-glow"></div>
      <div class="title-sub">T.C. HAVA KUVVETLERÄ° Â· SÄ°MÃœLATÃ–R</div>
      <h1>ACE<br><span class="red">STORM</span></h1>
    </div>
    <div class="divider"></div>
    
    <!-- BÃ–LÃœM SEÃ‡Ä°M -->
    <div id="chapterSelect">
      <div class="chapter-title">BÃ–LÃœM 1: EGE KORÄ°DORU</div>
      <div class="chapter-grid" id="chapter1Grid">
        <div class="mission-btn" data-chapter="1" data-mission="1">GÃ–REV 1<br><span class="mission-desc">KeÅŸif UÃ§uÅŸu</span></div>
        <div class="mission-btn" data-chapter="1" data-mission="2">GÃ–REV 2<br><span class="mission-desc">Devriye</span></div>
        <div class="mission-btn" data-chapter="1" data-mission="3">GÃ–REV 3<br><span class="mission-desc">Hava Savunma</span></div>
        <div class="mission-btn" data-chapter="1" data-mission="4">GÃ–REV 4<br><span class="mission-desc">Ä°mha</span></div>
        <div class="mission-btn" data-chapter="1" data-mission="5">GÃ–REV 5<br><span class="mission-desc">Filo Lideri</span></div>
        <div class="mission-btn" data-chapter="1" data-mission="6">GÃ–REV 6<br><span class="mission-desc">BOSS SAVAÅI</span></div>
      </div>
      
      <div class="chapter-title">BÃ–LÃœM 2: AKDENÄ°Z FIRTINASI</div>
      <div class="chapter-grid" id="chapter2Grid">
        <div class="mission-btn locked" data-chapter="2" data-mission="1">GÃ–REV 7<br><span class="mission-desc">ğŸ”’ Kilitli</span></div>
        <div class="mission-btn locked" data-chapter="2" data-mission="2">GÃ–REV 8<br><span class="mission-desc">ğŸ”’ Kilitli</span></div>
        <div class="mission-btn locked" data-chapter="2" data-mission="3">GÃ–REV 9<br><span class="mission-desc">ğŸ”’ Kilitli</span></div>
      </div>
    </div>
    
    <div id="finalBlock">
      <div class="final-score-label">SON GÃ–REV SKORU</div>
      <div class="final-score-val" id="finalVal">0</div>
    </div>
    <div class="stat-row">
      <div class="stat-box"><div class="stat-label">EN YÃœKSEK</div><div class="stat-val" id="hiDisp">0</div></div>
      <div class="stat-box"><div class="stat-label">BÃ–LÃœM</div><div class="stat-val" id="chapterDisp">1</div></div>
    </div>
    <button id="startBtn">GÃ–REVÄ° BAÅLAT</button>
    <div class="controls-grid">
      <div class="ctrl"><span class="key">SÃœRÃœKLE</span>Jet Hareketi</div>
      <div class="ctrl"><span class="key">BOMBA</span>ğŸ’£ Butonu</div>
      <div class="ctrl"><span class="key">P</span>Duraklat</div>
      <div class="ctrl"><span class="key">OTOMATÄ°K</span>AteÅŸ</div>
    </div>
  </div>
  
  <!-- DURAKLATMA MENÃœSÃœ -->
  <div id="pauseMenu">
    <h2>DURAKLATILDI</h2>
    <button id="resumeBtn">DEVAM</button>
    <button id="quitBtn">MENÃœ</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MOBÄ°L OPTÄ°MÄ°ZASYON & BÃ–LÃœM SÄ°STEMÄ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Canvas'larÄ± boyutlandÄ±r
function resizeCanvases() {
  const wrap = document.getElementById('wrap');
  const width = wrap.clientWidth;
  const height = wrap.clientHeight;
  
  ['bgCanvas', 'mainCanvas', 'fxCanvas', 'uiCanvas'].forEach(id => {
    const canvas = document.getElementById(id);
    canvas.width = width;
    canvas.height = height;
  });
}
window.addEventListener('resize', resizeCanvases);
resizeCanvases();

// BÃ–LÃœM SÄ°STEMÄ°
let currentChapter = 1;
let currentMission = 1;
let completedMissions = JSON.parse(localStorage.getItem('aceCompletedMissions')) || ['1-1'];

function saveProgress() {
  localStorage.setItem('aceCompletedMissions', JSON.stringify(completedMissions));
}

function unlockMissions() {
  // BÃ¶lÃ¼m 2'yi aÃ§ (1. bÃ¶lÃ¼mÃ¼n 6 gÃ¶revi tamamlanÄ±nca)
  const chapter1Complete = ['1-1','1-2','1-3','1-4','1-5','1-6'].every(m => completedMissions.includes(m));
  
  document.querySelectorAll('#chapter2Grid .mission-btn').forEach((btn, index) => {
    if(chapter1Complete) {
      btn.classList.remove('locked');
      btn.classList.add('completed');
      btn.dataset.mission = (index + 1).toString();
      btn.innerHTML = `GÃ–REV ${index+7}<br><span class="mission-desc">${index===2?'BOSS SAVAÅI':index===1?'Filo Ä°mha':'Hava ÃœstÃ¼nlÃ¼k'}</span>`;
    } else {
      btn.classList.add('locked');
    }
  });
}

// Mission butonlarÄ±na tÄ±klama
document.querySelectorAll('.mission-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    if(btn.classList.contains('locked')) return;
    
    // SeÃ§ili stili kaldÄ±r
    document.querySelectorAll('.mission-btn').forEach(b => b.style.background = '');
    
    // Bu butonu seÃ§
    btn.style.background = 'rgba(0,200,255,0.3)';
    
    currentChapter = parseInt(btn.dataset.chapter);
    currentMission = parseInt(btn.dataset.mission);
    
    document.getElementById('chapterDisp').textContent = currentChapter;
  });
});

// Ä°lk gÃ¶revi seÃ§
window.onload = () => {
  unlockMissions();
  document.querySelector('[data-chapter="1"][data-mission="1"]').style.background = 'rgba(0,200,255,0.3)';
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SES SÄ°STEMÄ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function playBeep(type = 'shoot', volume = 0.1) {
    if (!window.AudioContext && !window.webkitAudioContext) return;
    try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'shoot') {
            oscillator.frequency.value = 880.0;
            gainNode.gain.value = volume;
        } else if (type === 'explode') {
            oscillator.frequency.value = 150.0;
            gainNode.gain.value = volume * 2;
        } else if (type === 'lock') {
            oscillator.frequency.value = 440.0;
            gainNode.gain.value = volume * 0.5;
        } else if (type === 'powerup') {
            oscillator.frequency.value = 660.0;
            gainNode.gain.value = volume;
        }

        oscillator.start();
        gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.2);
        oscillator.stop(audioCtx.currentTime + 0.2);
    } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CANVAS SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const bgC  = document.getElementById('bgCanvas');
const mainC= document.getElementById('mainCanvas');
const fxC  = document.getElementById('fxCanvas');
const uiC  = document.getElementById('uiCanvas');
const bgX  = bgC.getContext('2d');
const ctx  = mainC.getContext('2d');
const fxX  = fxC.getContext('2d');
const uiX  = uiC.getContext('2d');
let W = bgC.width;
let H = bgC.height;

function offscreen(w,h,fn){
  const c=document.createElement('canvas');
  c.width=w;c.height=h;
  fn(c.getContext('2d'),w,h);
  return c;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SPRITE FACTORY (KÄ±sa versiyon - performans iÃ§in)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SPR_PLAYER = offscreen(64,88,(g,w,h)=>{
  g.fillStyle='#2a4a7a';
  g.beginPath();
  g.moveTo(w/2,2);
  g.lineTo(w/2+8,h*0.18);
  g.lineTo(w/2+7,h*0.52);
  g.lineTo(w/2+5,h*0.72);
  g.lineTo(w/2,  h*0.78);
  g.lineTo(w/2-5,h*0.72);
  g.lineTo(w/2-7,h*0.52);
  g.lineTo(w/2-8,h*0.18);
  g.closePath(); g.fill();
  g.fillStyle='#FFCC00';
  g.beginPath(); g.arc(w/2,h*0.32,5,0,Math.PI*2); g.fill();
});

const SPR_SU57 = offscreen(52,62,(g,w,h)=>{
  g.fillStyle='#882020';
  g.beginPath();
  g.moveTo(w/2,h-2);
  g.lineTo(w/2+7,h*0.7);
  g.lineTo(w/2+6,h*0.35);
  g.lineTo(w/2,h*0.1);
  g.lineTo(w/2-6,h*0.35);
  g.lineTo(w/2-7,h*0.7);
  g.closePath(); g.fill();
});

const SPR_MIG35 = offscreen(48,58,(g,w,h)=>{
  g.fillStyle='#6622AA';
  g.beginPath();
  g.moveTo(w/2,h-2);
  g.lineTo(w/2+6,h*0.68);
  g.lineTo(w/2+5,h*0.3);
  g.lineTo(w/2,h*0.08);
  g.lineTo(w/2-5,h*0.3);
  g.lineTo(w/2-6,h*0.68);
  g.closePath(); g.fill();
});

const SPR_BOMBER = offscreen(90,50,(g,w,h)=>{
  g.fillStyle='#1a1a2e';
  g.beginPath();
  g.moveTo(w/2,h-4);
  g.lineTo(w/2+3,h*0.3);
  g.lineTo(w-2,h*0.15);
  g.lineTo(w,h*0.55);
  g.lineTo(w*0.72,h*0.75);
  g.lineTo(w/2+10,h-2);
  g.lineTo(w/2,h+2);
  g.lineTo(w/2-10,h-2);
  g.lineTo(w*0.28,h*0.75);
  g.lineTo(0,h*0.55);
  g.lineTo(2,h*0.15);
  g.lineTo(w/2-3,h*0.3);
  g.closePath(); g.fill();
});

const SPR_F15 = offscreen(58,64,(g,w,h)=>{
  g.fillStyle='#4a7aaa';
  g.beginPath();
  g.moveTo(w/2,h-3);
  g.lineTo(w/2+7,h*0.6);
  g.lineTo(w/2+5,h*0.2);
  g.lineTo(w/2,h*0.05);
  g.lineTo(w/2-5,h*0.2);
  g.lineTo(w/2-7,h*0.6);
  g.closePath(); g.fill();
});

const SPR_BOSS_BODY = offscreen(180,160,(g,w,h)=>{
  g.fillStyle='#660010';
  g.beginPath();
  g.moveTo(w/2, h-8);
  g.lineTo(w/2+20,h*0.72);
  g.lineTo(w/2+26,h*0.45);
  g.lineTo(w/2+22,h*0.18);
  g.lineTo(w/2,    h*0.06);
  g.lineTo(w/2-22,h*0.18);
  g.lineTo(w/2-26,h*0.45);
  g.lineTo(w/2-20,h*0.72);
  g.closePath(); g.fill();
  g.fillStyle='#FF3300';
  g.beginPath(); g.arc(w/2,h*0.28,10,0,Math.PI*2); g.fill();
});

const SPR_TURRET = offscreen(24,24,(g,w,h)=>{
  g.fillStyle='#FF3300';
  g.beginPath(); g.arc(w/2,h/2,8,0,Math.PI*2); g.fill();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OBJECT POOL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Pool{
  constructor(factory,reset,n=80){
    this.free=[];this.active=[];
    this.factory=factory;this.reset=reset;
    for(let i=0;i<n;i++)this.free.push(factory());
  }
  get(o){const e=this.free.pop()||this.factory();this.reset(e,o);this.active.push(e);return e;}
  release(e){const i=this.active.indexOf(e);if(i>=0){this.active.splice(i,1);this.free.push(e);}}
  cull(fn){for(let i=this.active.length-1;i>=0;i--){if(fn(this.active[i])){this.free.push(this.active[i]);this.active.splice(i,1);}}}
  clear(){while(this.active.length)this.free.push(this.active.pop());}
}

const bulletPool=new Pool(
  ()=>({x:0,y:0,vx:0,vy:0,w:5,h:16,type:'p',dmg:1,trail:[],age:0}),
  (o,d)=>{Object.assign(o,d);o.trail=[];o.age=0;},150
);
const enemyPool=new Pool(
  ()=>({x:0,y:0,vx:0,vy:0,w:0,h:0,hp:1,maxHP:1,type:0,ft:0,wv:0,age:0,pattern:0}),
  (o,d)=>{Object.assign(o,d);o.ft=40+Math.random()*60;o.wv=Math.random()*Math.PI*2;o.age=0;o.pattern=Math.floor(Math.random()*3);},60
);
const ptPool=new Pool(
  ()=>({x:0,y:0,vx:0,vy:0,r:3,life:0,ml:30,col:'#FF6600',type:'circ',rot:0,vr:0}),
  (o,d)=>{Object.assign(o,d);o.ml=o.life;},300
);
const trailPool=new Pool(
  ()=>({x:0,y:0,life:0,ml:40,w:2}),
  (o,d)=>{Object.assign(o,d);o.ml=o.life;},200
);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let gState='idle', score=0, hiScore=0, lives=3, bombs=3, shield=0;
let frame=0, lastTime=0, dt=1;
let level=1, bossActive=false;
let shakeAmt=0, shakeX=0, shakeY=0;
let terrainOff=0;
let flashAlpha=0, flashColor='#FFFFFF';
let chromaticAberration=0;
let spawnT=0, bossT=0;
let paused = false;
let lastTouchTime = 0;
let autoFireTimer = 0;
const clouds=[];
const powerUps=[];
const warnings=[];
const contrails=[];

const player={x:W/2,y:H-120,vx:0,vy:0,w:52,h:66,inv:0,ft:0,ms:0,bank:0,thrustF:0};
const keys={};

const boss={active:false,x:W/2,y:140,vx:2,hp:0,maxHP:200,ft:0,phase:0,
  turrets:[{a:0,va:.03},{a:Math.PI*.66,va:-.025},{a:Math.PI*1.33,va:.02}]};

function lerp(a,b,t){return a+(b-a)*t;}
function dist(ax,ay,bx,by){return Math.sqrt((ax-bx)**2+(ay-by)**2);}
function collide(a,b){return Math.abs(a.x-b.x)<(a.w+b.w)*0.45&&Math.abs(a.y-b.y)<(a.h+b.h)*0.45;}
function rand(a,b){return a+Math.random()*(b-a);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EFFECTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function bigExplosion(x,y,size=1){
  playBeep('explode', 0.3);
  shakeAmt=Math.max(shakeAmt,18*size);
  flashAlpha=Math.min(1,0.5*size);
  flashColor=size>1.5?'#FF8800':'#FFAA44';
  chromaticAberration=Math.max(chromaticAberration,6*size);

  for(let i=0;i<10*size;i++){
    const a=rand(0,Math.PI*2), sp=rand(0.5,4)*size;
    ptPool.get({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,r:rand(5,15)*size,life:rand(20,40),
      col:['#FFFFFF','#FFD040','#FF8820','#FF4400'][Math.floor(rand(0,4))],type:'ball'});
  }
}

function smallExplosion(x,y){
  playBeep('explode', 0.1);
  for(let i=0;i<5;i++){
    const a=rand(0,Math.PI*2);
    ptPool.get({x,y,vx:Math.cos(a)*rand(1,4),vy:Math.sin(a)*rand(1,4),r:rand(2,5),life:rand(10,20),
      col:'#FF8800',type:'ball'});
  }
}

function coinSpark(x,y,col){
  for(let i=0;i<6;i++){
    const a=rand(0,Math.PI*2);
    ptPool.get({x,y,vx:Math.cos(a)*rand(1,3),vy:Math.sin(a)*rand(1,3)-1,r:3,life:20,col,type:'spark'});
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BACKGROUND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const terrainBuf = offscreen(480*2, 200, (g,w,h)=>{
  g.fillStyle='#030a1a';
  g.fillRect(0,0,w,h);
  for(let x=0;x<w;x+=30){
    g.fillStyle=`rgba(0,${50+Math.sin(x)*30},100,0.2)`;
    g.fillRect(x,0,10,h);
  }
});

function buildStaticBg(){
  bgX.fillStyle='#010510';
  bgX.fillRect(0,0,W,H);
}

function initClouds(){
  clouds.length=0;
  for(let i=0;i<10;i++){
    clouds.push({x:rand(0,W),y:rand(50,300),spd:rand(0.1,0.3),alpha:rand(0.1,0.2)});
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DRAW FUNCTIONS (BasitleÅŸtirilmiÅŸ - mobil performans iÃ§in)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawPlayerJet(spr, g, x, y, inv, shield, thrust, bank){
  g.save();
  g.translate(x,y);
  g.rotate(bank*0.08);
  if(inv && Math.floor(frame/5)%2===0) g.globalAlpha=0.5;
  g.drawImage(spr, -32, -44);
  g.globalAlpha=1;
  if(shield>0){
    g.strokeStyle='rgba(0,255,180,0.5)';
    g.lineWidth=2;
    g.beginPath(); g.ellipse(0,0,40,48,0,0,Math.PI*2); g.stroke();
  }
  g.restore();
}

function drawScene(){
  ctx.clearRect(0,0,W,H);
  ctx.save();
  if(shakeAmt>0) ctx.translate(shakeX,shakeY);

  // Arkaplan
  ctx.fillStyle='#020a22';
  ctx.fillRect(0,0,W,H);
  
  // YÄ±ldÄ±zlar
  for(let i=0;i<50;i++){
    ctx.fillStyle=`rgba(255,255,255,${0.1+Math.sin(i+frame*0.01)*0.05})`;
    ctx.fillRect((i*37)%W, (i*23)%(H*0.6), 1, 1);
  }

  // Åehir
  ctx.drawImage(terrainBuf, -terrainOff%960, H-150);
  
  // Bulutlar
  clouds.forEach(c=>{
    ctx.globalAlpha=c.alpha;
    ctx.fillStyle='rgba(120,160,210,0.1)';
    ctx.beginPath(); ctx.arc(c.x,c.y,30,0,Math.PI*2); ctx.fill();
    c.x-=c.spd*dt;
    if(c.x<-50) c.x=W+50;
  });

  // Mermiler
  bulletPool.active.forEach(b=>{
    ctx.fillStyle=b.type==='p'?'#00CCFF':'#FF3300';
    ctx.shadowBlur=10; ctx.shadowColor=b.type==='p'?'#00CCFF':'#FF3300';
    ctx.fillRect(b.x-2,b.y-8,4,16);
  });

  // DÃ¼ÅŸmanlar
  enemyPool.active.forEach(e=>{
    let spr = e.type===0?SPR_SU57 : e.type===1?SPR_MIG35 : e.type===2?SPR_BOMBER : SPR_F15;
    ctx.save();
    ctx.translate(e.x,e.y);
    ctx.drawImage(spr,-spr.width/2,-spr.height/2);
    ctx.restore();
    e.age+=dt;
  });

  // Power-up'lar
  powerUps.forEach(p=>{
    ctx.fillStyle='#00FFCC';
    ctx.shadowBlur=20; ctx.shadowColor='#00FFCC';
    ctx.beginPath(); ctx.arc(p.x,p.y,12,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#000';
    ctx.font="bold 12px 'Orbitron'";
    ctx.textAlign='center'; ctx.fillText(p.type[0].toUpperCase(),p.x,p.y+4);
  });

  // Boss
  if(boss.active){
    ctx.drawImage(SPR_BOSS_BODY, boss.x-90, boss.y-80);
    // HP bar
    ctx.fillStyle='#FF0000';
    ctx.fillRect(boss.x-90, boss.y-90, 180*(boss.hp/boss.maxHP), 8);
  }

  // Oyuncu
  drawPlayerJet(SPR_PLAYER, ctx, player.x, player.y,
    player.inv>0, shield, player.thrustF, player.bank);

  ctx.restore();

  // FX
  fxX.clearRect(0,0,W,H);
  if(flashAlpha>0){
    fxX.fillStyle=flashColor; fxX.globalAlpha=flashAlpha; fxX.fillRect(0,0,W,H);
    flashAlpha-=0.02;
  }
}

function drawHUD(){
  uiX.clearRect(0,0,W,H);

  // Skor
  uiX.font="bold 20px 'Orbitron'"; uiX.fillStyle='#00FFCC';
  uiX.textAlign='right'; uiX.fillText(score, W-10, 40);

  // Canlar
  for(let i=0;i<lives;i++){
    uiX.fillStyle='#00FFCC';
    uiX.fillRect(10+i*25, 10, 15, 15);
  }

  // Bombalar
  for(let i=0;i<bombs;i++){
    uiX.fillStyle='#FF6600';
    uiX.beginPath(); uiX.arc(20+i*25, 40, 7, 0, Math.PI*2); uiX.fill();
  }

  // UyarÄ±lar
  warnings.forEach((w,i)=>{
    uiX.font=`bold ${w.size||20}px Orbitron`;
    uiX.fillStyle=w.col||'#FFCC00';
    uiX.textAlign='center';
    uiX.fillText(w.text, W/2, w.y);
    w.y-=0.5; w.life--;
  });
  warnings = warnings.filter(w=>w.life>0);
  
  if(paused){
    uiX.fillStyle='rgba(0,200,255,0.9)';
    uiX.font="bold 24px Orbitron";
    uiX.textAlign='center';
    uiX.fillText('DURAKLATILDI', W/2, H/2);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function firePlayer(){
  playBeep('shoot', 0.05);
  bulletPool.get({x:player.x,y:player.y-30,vx:0,vy:-12,type:'p',dmg:1,w:5,h:18});
  if(player.ms>0){
    bulletPool.get({x:player.x-15,y:player.y-20,vx:-1,vy:-11,type:'p',dmg:1,w:5,h:18});
    bulletPool.get({x:player.x+15,y:player.y-20,vx:1,vy:-11,type:'p',dmg:1,w:5,h:18});
  }
}

function enemyFire(e){
  const dx=player.x-e.x, dy=player.y-e.y;
  const d=Math.sqrt(dx*dx+dy*dy)||1;
  bulletPool.get({x:e.x,y:e.y+e.h/2,vx:(dx/d)*3.5,vy:(dy/d)*3.5,type:'e',dmg:1,w:5,h:14});
}

function bossFire(){
  for(let a=-2;a<=2;a++){
    bulletPool.get({x:boss.x+a*20,y:boss.y+50,vx:a*0.5,vy:4,type:'e',dmg:1,w:6,h:16});
  }
}

function spawnPowerUp(x,y){
  const types=['multi','shield','bomb','health'];
  powerUps.push({x,y,vy:1,type:types[Math.floor(rand(0,4))],life:300});
}

function applyPowerUp(p){
  playBeep('powerup',0.2);
  warnings.push({text:p.type.toUpperCase(),y:H/2-50,life:60,size:30,col:'#00FFCC'});
  if(p.type==='multi') player.ms=400;
  else if(p.type==='shield') shield=Math.min(300,shield+150);
  else if(p.type==='bomb') bombs++;
  else if(p.type==='health') lives++;
}

function useBomb(){
  if(bombs<=0) return;
  bombs--;
  bigExplosion(player.x,player.y-50,2);
  bulletPool.cull(b=>b.type==='e');
  enemyPool.active.forEach(e=>{ e.hp-=5; smallExplosion(e.x,e.y); });
  if(boss.active) boss.hp-=20;
}

function hitPlayer(){
  if(player.inv>0) return;
  if(shield>0){ shield=0; player.inv=60; return; }
  lives--;
  player.inv=120;
  bigExplosion(player.x,player.y,1);
  if(lives<=0){
    player.inv=999;
    warnings.push({text:'JET Ä°MHA',y:H/2,life:120,col:'#FF0000',size:40});
    setTimeout(endGame, 1500);
  }
}

function spawnEnemy(){
  const types = [
    {type:0, hp:1, w:52, h:62, vy:2},  // Su-57
    {type:1, hp:2, w:48, h:58, vy:1.8}, // MiG-35
    {type:2, hp:4, w:90, h:50, vy:1.2}, // B-2
    {type:3, hp:3, w:58, h:64, vy:2.2}  // F-15
  ];
  let t = types[Math.floor(Math.random()*types.length)];
  enemyPool.get({...t, x:rand(40,W-40), y:rand(-50,-20), vx:rand(-1,1)});
}

function spawnBoss(){
  boss.active=true; boss.x=W/2; boss.y=-50; boss.maxHP=100+level*50; boss.hp=boss.maxHP;
  boss.vx=2; bossActive=true; enemyPool.clear();
  warnings.push({text:'BOSS GELÄ°YOR',y:H/2,life:90,size:30,col:'#FF4400'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function update(ts){
  if(gState!=='playing' || paused) return;
  dt=Math.min((ts-lastTime)/16.667,3);
  lastTime=ts; frame++;

  // Otomatik ateÅŸ (sÃ¼rekli)
  autoFireTimer-=dt;
  if(autoFireTimer<=0){
    firePlayer();
    autoFireTimer = player.ms>0 ? 8 : 12;
  }

  // Player hareket (mobil iÃ§in parmakla)
  // touchmove'da gÃ¼ncellenecek

  // Atalet
  player.x = Math.max(30, Math.min(W-30, player.x + player.vx*dt));
  player.y = Math.max(70, Math.min(H-70, player.y + player.vy*dt));
  player.vx = lerp(player.vx, 0, 0.1);
  player.vy = lerp(player.vy, 0, 0.1);
  if(player.inv>0) player.inv-=dt;
  if(player.ms>0) player.ms-=dt;

  // Scroll
  terrainOff += 2*dt;

  // SarsÄ±ntÄ±
  if(shakeAmt>0){
    shakeAmt*=0.95;
    shakeX = (Math.random()-0.5)*shakeAmt;
    shakeY = (Math.random()-0.5)*shakeAmt;
  }

  // Spawn
  if(!bossActive){
    spawnT-=dt;
    if(spawnT<=0){
      spawnEnemy();
      spawnT = Math.max(15, 40 - level*2);
    }
    bossT-=dt;
    if(bossT<=0 && currentMission % 3 === 0){ spawnBoss(); bossT=2000; }
  }

  // Mermiler
  bulletPool.active.forEach(b=>{ b.x+=b.vx*dt; b.y+=b.vy*dt; });
  bulletPool.cull(b=>b.y<-20||b.y>H+20||b.x<-20||b.x>W+20);

  // DÃ¼ÅŸmanlar
  enemyPool.active.forEach(e=>{
    e.x+=e.vx*dt; e.y+=e.vy*dt;
    e.ft-=dt;
    if(e.ft<=0){ enemyFire(e); e.ft=30+Math.random()*30; }
    if(e.y>H+50 || e.hp<=0){
      if(e.hp<=0){
        bigExplosion(e.x,e.y,0.8);
        score += e.type===2?300 : 100;
        if(Math.random()<0.1) spawnPowerUp(e.x,e.y);
      }
      e.active=false;
    }
    if(collide({x:e.x,y:e.y,w:e.w*0.6,h:e.h*0.6},{x:player.x,y:player.y,w:30,h:40})){
      hitPlayer(); e.hp=0;
    }
  });
  enemyPool.cull(e=>!e.active);

  // Ã‡arpÄ±ÅŸmalar
  bulletPool.active.forEach(b=>{
    if(b.type==='p'){
      enemyPool.active.forEach(e=>{
        if(!b.active) return;
        if(Math.abs(b.x-e.x)<e.w*0.4 && Math.abs(b.y-e.y)<e.h*0.4){
          e.hp-=b.dmg; b.active=false;
          smallExplosion(b.x,b.y);
        }
      });
      if(boss.active && b.active && Math.abs(b.x-boss.x)<70 && Math.abs(b.y-boss.y)<50){
        boss.hp-=b.dmg; b.active=false;
        if(boss.hp<=0){
          bigExplosion(boss.x,boss.y,3);
          boss.active=false; bossActive=false;
          score+=2000; level++;
          
          // GÃ¶revi tamamlandÄ± olarak iÅŸaretle
          let missionId = `${currentChapter}-${currentMission}`;
          if(!completedMissions.includes(missionId)){
            completedMissions.push(missionId);
            saveProgress();
            unlockMissions();
          }
          
          warnings.push({text:'GÃ–REV TAMAM',y:H/2-20,life:120,size:30,col:'#FFCC00'});
        }
      }
    } else {
      if(Math.abs(b.x-player.x)<20 && Math.abs(b.y-player.y)<25){
        hitPlayer(); b.active=false;
      }
    }
  });
  bulletPool.cull(b=>!b.active);

  // Boss
  if(boss.active){
    boss.x+=boss.vx*dt;
    if(boss.x<80 || boss.x>W-80) boss.vx*=-1;
    if(boss.y<120) boss.y+=2*dt;
    boss.ft-=dt;
    if(boss.ft<=0){ bossFire(); boss.ft=30; }
  }

  // Power-up'lar
  for(let i=powerUps.length-1;i>=0;i--){
    let p=powerUps[i];
    p.y+=p.vy*dt; p.life-=dt;
    if(p.life<=0 || p.y>H+30){ powerUps.splice(i,1); continue; }
    if(Math.abs(p.x-player.x)<20 && Math.abs(p.y-player.y)<20){
      applyPowerUp(p); powerUps.splice(i,1);
    }
  }

  // PartikÃ¼ller
  ptPool.active.forEach(p=>{ p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=dt; });
  ptPool.cull(p=>p.life<=0);

  score++;
  if(score>hiScore) hiScore=score;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let rafID=null;
function loop(ts){
  if(gState==='playing') update(ts);
  drawScene();
  drawHUD();
  rafID=requestAnimationFrame(loop);
}

function startGame(){
  if(rafID) cancelAnimationFrame(rafID);
  
  // BÃ¶lÃ¼m ayarlarÄ±
  level = currentChapter * 2 + currentMission;
  lives = 3 + Math.floor(currentMission/2);
  bombs = 2 + Math.floor(currentMission/3);
  
  gState='playing'; paused=false;
  score=0; shield=0; player.inv=60;
  player.x=W/2; player.y=H-120; player.vx=0; player.vy=0;
  bossActive=false; boss.active=false;
  spawnT=20; bossT=800;
  bulletPool.clear(); enemyPool.clear(); ptPool.clear();
  powerUps.length=0; warnings.length=0;
  
  document.getElementById('overlay').style.display='none';
  document.getElementById('pauseMenu').style.display='none';
  document.getElementById('bombBtn').style.display='flex';
  
  lastTime=performance.now();
  rafID=requestAnimationFrame(loop);
}

function endGame(){
  gState='dead'; paused=false;
  cancelAnimationFrame(rafID);
  if(score>hiScore) hiScore=score;
  document.getElementById('finalVal').textContent=score;
  document.getElementById('hiDisp').textContent=hiScore;
  document.getElementById('chapterDisp').textContent=currentChapter;
  document.getElementById('finalBlock').style.display='block';
  document.getElementById('overlay').style.display='flex';
  document.getElementById('bombBtn').style.display='none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MOBÄ°L KONTROLLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
mainC.addEventListener('touchstart', e => {
  e.preventDefault();
  const touch = e.touches[0];
  const rect = mainC.getBoundingClientRect();
  player.x = Math.max(30, Math.min(W-30, (touch.clientX - rect.left) * (W/rect.width)));
  player.y = Math.max(70, Math.min(H-70, (touch.clientY - rect.top) * (H/rect.height)));
  player.vx = 0; player.vy = 0;
  lastTouchTime = Date.now();
});

mainC.addEventListener('touchmove', e => {
  if(gState!=='playing' || paused) return;
  e.preventDefault();
  const touch = e.touches[0];
  const rect = mainC.getBoundingClientRect();
  let newX = (touch.clientX - rect.left) * (W/rect.width);
  let newY = (touch.clientY - rect.top) * (H/rect.height);
  
  // HÄ±zÄ± hesapla (kaydÄ±rma hissi iÃ§in)
  player.vx = (newX - player.x) * 0.3;
  player.vy = (newY - player.y) * 0.3;
  
  player.x = Math.max(30, Math.min(W-30, newX));
  player.y = Math.max(70, Math.min(H-70, newY));
}, {passive:false});

// Bomba butonu
document.getElementById('bombBtn').addEventListener('touchstart', e => {
  e.preventDefault();
  if(gState==='playing') useBomb();
});

// Klavye (debug iÃ§in)
document.addEventListener('keydown', e => {
  keys[e.key]=true;
  if(e.key===' ' && gState==='playing'){ e.preventDefault(); useBomb(); }
  if((e.key==='p'||e.key==='P') && gState==='playing'){
    paused=!paused; document.getElementById('pauseMenu').style.display=paused?'flex':'none';
  }
  if(e.key==='Escape' && paused){ paused=false; document.getElementById('pauseMenu').style.display='none'; }
});
document.addEventListener('keyup', e => { keys[e.key]=false; });

// Menu butonlarÄ±
document.getElementById('startBtn').addEventListener('click', startGame);
document.getElementById('resumeBtn').addEventListener('click', ()=>{ paused=false; document.getElementById('pauseMenu').style.display='none'; });
document.getElementById('quitBtn').addEventListener('click', ()=>{ paused=false; endGame(); });

// BaÅŸlangÄ±Ã§
buildStaticBg();
initClouds();
</script>
</body>
</html>